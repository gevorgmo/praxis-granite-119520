/**
 * Synchronize.js
 * Compiled on 14.06.2015
 * Version 1.2.3
 *
 *  Copyright (C) 2013-2015 Denis Meyer, calltopower88@googlemail.com
 * All rights reserved.

 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 * 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
!function(a){function b(a){T&&window.console&&console.log(a)}function c(a,b,c){return!isNaN(a)&&!isNaN(b)&&!isNaN(c)&&c>=b?a>=b&&c>=a:!1}function d(c){return c?f()?videojs(c):a("#"+c):void b("SJS: [getVideoObj] Undefined video element id '"+c+"'")}function e(a){return a?f()?videojs(a):d(a).get(0):void b("SJS: [getVideo] Undefined video element id '"+a+"'")}function f(){return"undefined"!=typeof videojs}function g(a){if(f()&&a){var b=a.id();return""!==b?b:a}return a}function h(a){return Z?(b("SJS: [play] A video is currently buffering"),!1):a?(b("SJS: [play] Playing video element id '"+a+"'"),e(a).play(),!0):(b("SJS: [play] Undefined video element id '"+a+"'"),!1)}function i(a){return a?(b("SJS: [mute] Muting video element id '"+a+"'"),void(f()?e(a).volume(0):e(a).muted=!0)):void b("SJS: [mute] Undefined video element id '"+a+"'")}function j(a){return a?(b("SJS: [pause] Pausing video element id '"+a+"'"),e(a).pause()):(b("SJS: [pause] Undefined video element id '"+a+"'"),!1)}function k(a){return a?f()?e(a).paused():e(a).paused:(b("SJS: [isPaused] Undefined video element id '"+a+"'"),!1)}function l(a){return a?f()?e(a).duration():e(a).duration:(b("SJS: [getDuration] Undefined video element id '"+a+"'"),-1)}function m(a){return a?f()?e(a).currentTime():e(a).currentTime:(b("SJS: [getCurrentTime] Undefined video element id '"+a+"'"),-1)}function n(a,c){if(a){var d=l(a);return-1!=d&&!isNaN(c)&&c>=0&&d>=c?(f()?e(a).currentTime(c):e(a).currentTime=c,!0):(b("SJS: [setCurrentTime] Could not set time for video element id '"+a+"'"),n(a,d),!1)}return b("SJS: [setCurrentTime] Undefined video element id '"+a+"'"),!1}function o(a){return a?f()?e(a).playbackRate():e(a).playbackRate:(b("SJS: [getPlaybackRate] Undefined video element id '"+a+"'"),1)}function p(a,c){return a?(f()?e(a).playbackRate(c):e(a).playbackRate=c,!0):(b("SJS: [setPlaybackRate] Undefined video element id '"+a+"'"),!1)}function q(a){return a?f()?e(a).buffered():e(a).buffered:void b("SJS: [getBufferTimeRange] Undefined video element id '"+a+"'")}function r(a){var b=m(B),d=m(a);return-1==b||-1==d||c(d,b-K,b)?0:d-b}function s(){for(var c=0;c<U.length;++c)if(U[c]!=B){var d=!1,e=r(U[c]);ia?ia&&(Math.abs(e)>S&&Math.abs(e)>P?d=!0:k(B)||ha[U[c]]||(b("SJS: [synchronize] Playing video element id '"+U[c]+"'"),h(U[c]))):e>Q?Math.abs(e)<L?(a(document).trigger("sjs:synchronizing",[m(B),U[c]]),b("SJS: [synchronize] Decreasing playback rate of video element id '"+U[c]+"' from "+o(U[c])+" to "+(o(B)-.5)),p(U[c],o(B)+N)):(a(document).trigger("sjs:synchronizing",[m(B),U[c]]),p(U[c],o(B)),d=!0):R>e?Math.abs(e)<L?(a(document).trigger("sjs:synchronizing",[m(B),U[c]]),b("SJS: [synchronize] Increasing playback rate of video element id '"+U[c]+"' from "+o(U[c])+" to "+(o(B)-.5)),p(U[c],o(B)+M)):(a(document).trigger("sjs:synchronizing",[m(B),U[c]]),p(U[c],o(B)),d=!0):k(B)||ha[U[c]]||(p(U[c],o(B)),b("SJS: [synchronize] Playing video element id '"+U[c]+"'"),h(U[c])),d&&(a(document).trigger("sjs:synchronizing",[m(B),U[c]]),b("SJS: [synchronize] Seeking video element id '"+U[c]+"': "+(m(B)+O)),n(U[c],m(B)+O)&&(h(U[c]),k(B)||ha[U[c]]?(b("SJS: [synchronize] Pausing video element id '"+U[c]+"' after seeking"),j(U[c])):(b("SJS: [synchronize] Playing video element id '"+U[c]+"' after seeking"),h(U[c]))))}}function t(){if(x()){var c=d(B);ia=0!==a("#"+B+"_flash_api").length,c.on("play",function(){b("SJS: Master received 'play' event"),a(document).trigger("sjs:masterPlay",[m(B)]),ca=!1,!_&&D&&(_=!0,u());for(var c=0;c<U.length;++c)U[c]!=B&&(h(U[c]),i(U[c]))}),c.on("pause",function(){b("SJS: Master received 'pause' event"),a(document).trigger("sjs:masterPause",[m(B)]),ca=!ba&&aa,ba=ba?!ba:ba;for(var c=0;c<U.length;++c)U[c]!=B&&(j(U[c]),s())}),c.on("ratechange",function(){b("SJS: Master received 'ratechange' event"),a(document).trigger("sjs:masterPlaybackRateChanged",[o(B)]);for(var c=0;c<U.length;++c)U[c]!=B&&p(U[c],o(B))}),c.on("ended",function(){b("SJS: Master received 'ended' event"),a(document).trigger("sjs:masterEnded",[l(B)]),ca=!0;for(var c=0;c<U.length;++c)U[c]!=B&&(s(),j(U[c]))}),c.on("timeupdate",function(){a(document).trigger("sjs:masterTimeupdate",[m(B)]),ca=!0;var b=Date.now();if(b-I>J||k(B)){I=b;for(var c,d=0;d<U.length;++d)U[d]!=B&&(i(U[d]),c=k(U[d]),s())}})}else for(var e=0;e<U.length;++e)j(U[e])}function u(){C=window.setInterval(function(){{var b,d=!0;m(B)}for(b=0;b<U.length;++b){var e=q(U[b]);if(e){for(var f=l(U[b]),g=m(U[b])+G,i=!1,k=0;k<e.length&&!i;++k)g=g>=f?f:g,c(g,e.start(k),e.end(k))&&(i=!0);d=d&&i,Z=!d}}if(d)aa&&!ca?(aa=!1,h(B),ca=!1,a(document).trigger("sjs:bufferedAndAutoplaying",[])):aa&&(aa=!1,a(document).trigger("sjs:bufferedButNotAutoplaying",[]));else{for(aa=!0,ba=!0,b=0;b<U.length;++b)j(U[b]);ca=!1,a(document).trigger("sjs:buffering",[])}},E)}function v(b){X=b<U.length?b:0,B=U[X],a(document).trigger("sjs:masterSet",[B])}function w(a,c){""!==a?d(a).on("loadeddata",function(){fa=!0,c&&c()}):b("SJS: [doWhenDataLoaded] Undefined video element id '"+a+"'")}function x(){if(f()){for(var a=0;a<U.length;++a)if(!W[U[a]])return!1;return!0}return Y==U.length}function y(){for(var a=0;a<U.length;++a)j(U[a]);$=!0}function z(){for(var a=0;a<U.length;++a)j(U[a]);$=!1}function A(){null!==da&&(window.clearInterval(da),da=null)}var B,C,D=!0,E=1e3,F=5e3,G=2,H=!0,I=0,J=1e3,K=1,L=4,M=.5,N=-.5,O=.25,P=O+.05,Q=.05,R=-.05,S=.05,T=!1,U=[],V={},W={},X=0,Y=0,Z=!1,$=!1,_=!1,aa=!1,ba=!1,ca=!1,da=null,ea=1e4,fa=!1,ga=null,ha=[],ia=!1;a.synchronizeVideos=function(c,e){var i,k=!0;if(2==arguments.length){var l=a('video[mediagroup="'+e+'"]');for(i=0;i<l.length;++i){var m=U.length;U[m]=l[i].getAttribute("id");var o="_html5_api";U[m]=f()&&-1!=U[m].indexOf(o)?U[m].substr(0,U[m].length-o.length):U[m],V[U[i-1]]=!1,W[U[i-1]]=!1}}else for(X=c,i=1;i<arguments.length;++i)k=k&&arguments[i]&&a("#"+arguments[i]).length,k?(U[U.length]=arguments[i],V[U[i-1]]=!1,W[U[i-1]]=!1):a(document).trigger("sjs:invalidId",[arguments[i]]);if(k&&U.length>1){var p;if(f())for(i=0;i<U.length;++i)a(document).trigger("sjs:idRegistered",[U[i]]),p=c,d(U[i]).on("play",y),d(U[i]).on("pause",z),d(U[i]).ready(function(){var b=g(this);V[b]=!0,w(b,function(){if(W[b]=!0,a(document).trigger("sjs:playerLoaded",[b]),x()){v(p);for(var c=0;c<U.length;++c)d(U[c]).off("play",y),d(U[c]).off("pause",z);t(),$&&h(B),a(document).trigger("sjs:allPlayersReady",[])}}),ga=window.setInterval(function(){if(fa)window.clearInterval(ga),ga=null;else for(var a=0;a<U.length;++a)d(U[a]).trigger("loadeddata")},F)});else for(i=0;i<U.length;++i)a(document).trigger("sjs:idRegistered",[U[i]]),p=c,d(U[i]).on("play",y),d(U[i]).on("pause",z),d(U[i]).ready(function(){if(++Y,x()){v(p);for(var b=0;b<U.length;++b)d(U[b]).off("play",y),d(U[b]).off("pause",z);t(),$&&h(B),a(document).trigger("sjs:allPlayersReady",[])}})}else b("SJS: Not enough videos"),a(document).trigger("sjs:notEnoughVideos",[]);H&&(a(document).on("sjs:buffering",function(){b("SJS: Received 'sjs:buffering' event"),da=setInterval(function(){x()&&!ca&&h(B)},ea)}),a(document).on("sjs:bufferedAndAutoplaying",function(){b("SJS: Received 'sjs:bufferedAndAutoplaying' event"),A()}),a(document).on("sjs:bufferedButNotAutoplaying",function(){b("SJS: Received 'sjs:bufferedButNotAutoplaying' event"),A()})),a(document).on("sjs:play",function(){b("SJS: Received 'sjs:play' event"),x()&&h(B)}),a(document).on("sjs:pause",function(){b("SJS: Received 'sjs:pause' event"),x()&&j(B)}),a(document).on("sjs:setCurrentTime",function(a,c){b("SJS: Received 'sjs:setCurrentTime' event"),x()&&n(B,c)}),a(document).on("sjs:synchronize",function(){b("SJS: Received 'sjs:synchronize' event"),x()&&s()}),a(document).on("sjs:startBufferChecker",function(){b("SJS: Received 'sjs:startBufferChecker' event"),_||(window.clearInterval(C),_=!0,u())}),a(document).on("sjs:stopBufferChecker",function(){b("SJS: Received 'sjs:stopBufferChecker' event"),window.clearInterval(C),_=!1,Z=!1})},a(document).on("sjs:debug",function(a,c){T=c,b("SJS: Received 'sjs:debug' event")})}(jQuery);