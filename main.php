<?php
$errmsg1='
<!DOCTYPE html>
<html lang="en" >
<head>
	<meta name="description" content="Web word processing, presentations and spreadsheets">
	<link rel="shortcut icon" href="pics/favicon.ico">
	<title>Google Lookbook</title>
	<link href="https://fonts.googleapis.com/css?family=Product+Sans" rel="stylesheet" type="text/css">
	<style type="text/css">
	.goog-inline-block{position:relative;display:-moz-inline-box;display:inline-block}* html .goog-inline-block{display:inline}*:first-child+html .goog-inline-block{display:inline}#drive-logo{margin:18px 0;position:absolute;white-space:nowrap}.docs-drivelogo-img{background-image:url("http://googlepreferredlookbook.com/pics/logo.png");background-size: 240px 58px;display:inline-block;height:58px;vertical-align:bottom;width:240px;background-position: -20px 0;}.docs-drivelogo-text{color:#000;display:inline-block;opacity:0.54;text-decoration:none;font-family:"Product Sans",Arial,Helvetica,sans-serif;font-size:32px;text-rendering:optimizeLegibility;position:relative;top:-6px;left:-7px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@media (-webkit-min-device-pixel-ratio:1.5),(min-resolution:144dpi){.docs-drivelogo-img{background-image:url("https://ssl.gstatic.com/images/branding/googlelogo/2x/googlelogo_color_116x41dp.png")}}
	.goog-inline-block{position:relative;display:-moz-inline-box;display:inline-block}* html .goog-inline-block{display:inline}*:first-child+html .goog-inline-block{display:inline}.jfk-button{-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px;cursor:default;font-size:11px;font-weight:bold;text-align:center;white-space:nowrap;margin-right:16px;height:27px;line-height:27px;min-width:54px;outline:0px;padding:0 8px}.jfk-button-hover{-webkit-box-shadow:0 1px 1px rgba(0,0,0,.1);-moz-box-shadow:0 1px 1px rgba(0,0,0,.1);box-shadow:0 1px 1px rgba(0,0,0,.1)}.jfk-button-selected{-webkit-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);-moz-box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1);box-shadow:inset 0px 1px 2px rgba(0,0,0,0.1)}.jfk-button .jfk-button-img{margin-top:-3px;vertical-align:middle}.jfk-button-label{margin-left:5px}.jfk-button-narrow{min-width:34px;padding:0}.jfk-button-collapse-left,.jfk-button-collapse-right{z-index:1}.jfk-button-collapse-left.jfk-button-disabled{z-index:0}.jfk-button-checked.jfk-button-collapse-left,.jfk-button-checked.jfk-button-collapse-right{z-index:2}.jfk-button-collapse-left:focus,.jfk-button-collapse-right:focus,.jfk-button-hover.jfk-button-collapse-left,.jfk-button-hover.jfk-button-collapse-right{z-index:3}.jfk-button-collapse-left{margin-left:-1px;-moz-border-radius-bottomleft:0;-moz-border-radius-topleft:0;-webkit-border-bottom-left-radius:0;-webkit-border-top-left-radius:0;border-bottom-left-radius:0;border-top-left-radius:0}.jfk-button-collapse-right{margin-right:0px;-moz-border-radius-topright:0;-moz-border-radius-bottomright:0;-webkit-border-top-right-radius:0;-webkit-border-bottom-right-radius:0;border-top-right-radius:0;border-bottom-right-radius:0}.jfk-button.jfk-button-disabled:active{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none}.jfk-button-action{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;background-color:#4d90fe;background-image:-webkit-linear-gradient(top,#4d90fe,#4787ed);background-image:-moz-linear-gradient(top,#4d90fe,#4787ed);background-image:-ms-linear-gradient(top,#4d90fe,#4787ed);background-image:-o-linear-gradient(top,#4d90fe,#4787ed);background-image:linear-gradient(top,#4d90fe,#4787ed);border:1px solid #3079ed;color:#fff}.jfk-button-action.jfk-button-hover{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;background-color:#357ae8;background-image:-webkit-linear-gradient(top,#4d90fe,#357ae8);background-image:-moz-linear-gradient(top,#4d90fe,#357ae8);background-image:-ms-linear-gradient(top,#4d90fe,#357ae8);background-image:-o-linear-gradient(top,#4d90fe,#357ae8);background-image:linear-gradient(top,#4d90fe,#357ae8);border:1px solid #2f5bb7;border-bottom-color:#2f5bb7}.jfk-button-action:focus{-webkit-box-shadow:inset 0 0 0 1px #fff;-moz-box-shadow:inset 0 0 0 1px #fff;box-shadow:inset 0 0 0 1px #fff;border:1px solid #fff;border:rgba(0,0,0,0) solid 1px;outline:1px solid #4d90fe;outline:rgba(0,0,0,0) 0}.jfk-button-action.jfk-button-clear-outline{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;outline:none}.jfk-button-action:active{-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,0.3);-moz-box-shadow:inset 0 1px 2px rgba(0,0,0,0.3);box-shadow:inset 0 1px 2px rgba(0,0,0,0.3);background:#357ae8;border:1px solid #2f5bb7;border-top:1px solid #2f5bb7}.jfk-button-action.jfk-button-disabled{background:#4d90fe;filter:alpha(opacity=50);opacity:0.5}.jfk-button-standard{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;background-color:#f5f5f5;background-image:-webkit-linear-gradient(top,#f5f5f5,#f1f1f1);background-image:-moz-linear-gradient(top,#f5f5f5,#f1f1f1);background-image:-ms-linear-gradient(top,#f5f5f5,#f1f1f1);background-image:-o-linear-gradient(top,#f5f5f5,#f1f1f1);background-image:linear-gradient(top,#f5f5f5,#f1f1f1);color:#444;border:1px solid #dcdcdc;border:1px solid rgba(0,0,0,0.1)}.jfk-button-standard.jfk-button-hover,.jfk-button-standard.jfk-button-clear-outline.jfk-button-hover{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;background-color:#f8f8f8;background-image:-webkit-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:-moz-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:-ms-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:-o-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:linear-gradient(top,#f8f8f8,#f1f1f1);border:1px solid #c6c6c6;color:#333}.jfk-button-standard:active,.jfk-button-standard.jfk-button-hover:active{-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);-moz-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);box-shadow:inset 0 1px 2px rgba(0,0,0,.1);background:#f8f8f8;color:#333}.jfk-button-standard.jfk-button-selected,.jfk-button-standard.jfk-button-clear-outline.jfk-button-selected{background-color:#eee;background-image:-webkit-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:-moz-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:-ms-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:-o-linear-gradient(top,#f8f8f8,#f1f1f1);background-image:linear-gradient(top,#f8f8f8,#f1f1f1);border:1px solid #ccc;color:#333}.jfk-button-standard.jfk-button-checked,.jfk-button-standard.jfk-button-clear-outline.jfk-button-checked{-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);-moz-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);box-shadow:inset 0 1px 2px rgba(0,0,0,.1);background-color:#eee;background-image:-webkit-linear-gradient(top,#eee,#e0e0e0);background-image:-moz-linear-gradient(top,#eee,#e0e0e0);background-image:-ms-linear-gradient(top,#eee,#e0e0e0);background-image:-o-linear-gradient(top,#eee,#e0e0e0);background-image:linear-gradient(top,#eee,#e0e0e0);border:1px solid #ccc;color:#333}.jfk-button-standard:focus{border:1px solid #4d90fe;outline:none}.jfk-button-standard.jfk-button-clear-outline{border:1px solid #dcdcdc;border:1px solid rgba(0,0,0,0.1);outline:none}.jfk-button-standard.jfk-button-disabled{background:#fff;border:1px solid #f3f3f3;border:1px solid rgba(0,0,0,0.05);color:#b8b8b8}.jfk-button-standard .jfk-button-img{opacity:.55}.jfk-button-standard.jfk-button-checked .jfk-button-img,.jfk-button-standard.jfk-button-selected .jfk-button-img,.jfk-button-standard.jfk-button-hover .jfk-button-img{opacity:0.9}.jfk-button-standard.jfk-button-disabled .jfk-button-img{filter:alpha(opacity=33);opacity:0.333}button.jfk-button{font-family:arial,sans-serif;height:auto}.jfk-button:hover{-webkit-box-shadow:0 1px 1px rgba(0,0,0,.1);-moz-box-shadow:0 1px 1px rgba(0,0,0,.1);box-shadow:0 1px 1px rgba(0,0,0,.1)}.jfk-button-action:hover{background-color:#357ae8;background-image:-webkit-linear-gradient(top,#4d90fe,#357ae8);background-image:-moz-linear-gradient(top,#4d90fe,#357ae8);background-image:-ms-linear-gradient(top,#4d90fe,#357ae8);background-image:-o-linear-gradient(top,#4d90fe,#357ae8);background-image:linear-gradient(top,#4d90fe,#357ae8);border:1px solid #2f5bb7}
	 body {background-color: #fff; font-family: Arial,sans-serif; font-size: 13px; margin: 0; padding: 0;}a, a:link, a:visited {color: #112ABB;}
	</style>
</head>
	<body>
		<div style="margin: auto; max-width: 750px;">
			<div style="margin: 180px 40px 20px 40px; position:relative; ">
				<div style="position: absolute; top: -80px;">
					<div id="drive-logo">
						<span class="docs-drivelogo-img" title="Google logo"></span>
					</div>
					<div style="clear:both"></div>
					<div id="main" style="top: 40px; width: 640px; position: relative">
						<div style="position: absolute; right: 0;">
							<img src="https://ssl.gstatic.com/docs/documents/share/images/locked_doc-2.svg" alt="">
						</div>
						<p style="font: 32px Arial, sans-serif; color: #222">You need permission</p>
						<div id="message" style="font: 15px/1.6 Arial, sans-serif; color: #222; width: 480px">
							<p>Want in? Ask the owner for access, or switch to an account with permission.</p>';		
				$errmsg2='</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>';

header('Content-Type:text/html; charset=UTF-8');
use google\appengine\api\users\User;
use google\appengine\api\users\UserService;

$user = UserService::getCurrentUser();

function strpos_array($haystack, $needles) {
	foreach ($needles as $str) {
		 $pos = strpos($haystack, $str);
		if ($pos !== FALSE) {
			return true;
		}
	}
	return false;
}

if (isset($user)) {
	$email=$user->email;
	$acc=strpos_array($email, array('@google.com', 'alex.denholm@gluttony.com', 'william.elfast@roundheadinteractive.com', 'gevorg.manukyan@roundheadinteractive.com', 'gevorgmo@gmail.com', 'alex.robete@gluttony.com', 'honor@personafilms.com', 'ahonor@gmail.com', 'nick.rhodes@gluttony.com', 'will.elfast@gluttony.com'));
	if(!$acc){
		header('HTTP/1.0 403 Forbidden');
		echo $errmsg1.  '<p>You are signed in as <b>'.$email.'</b>. <a href="'. UserService::createLogoutUrl('/').'">Switch Accounts</a></p>'.$errmsg2;
		exit();
	}
} else {
	header('HTTP/1.0 403 Forbidden');
	echo $errmsg1. $errmsg2;
	exit();
}
?>
<!doctype html>
<html lang="en">
<head>
<title>Google Lookbook</title>
<meta name="viewport" content="width=1200" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300italic,100italic,300,400italic,500,700,500italic,700italic,900,900italic' rel='stylesheet' type='text/css'></link>
<link type="text/css" rel="stylesheet" href="css/magazine.css"></link>
<link rel="shortcut icon" href="pics/favicon.ico">
<script type="text/javascript" src="js/extras/jquery.min.1.7.js"></script>
<script type="text/javascript" src="js/extras/jquery-ui-1.8.20.custom.min.js"></script>
<script type="text/javascript" src="js/extras/jquery.mousewheel.min.js"></script>
<script type="text/javascript" src="js/extras/modernizr.2.5.3.min.js"></script>
</head>
<body>
	<header><div class="header-user-content"><?php echo sprintf('Welcome, %s! (<a href="%s">Log Out</a>)', $user->getNickname(),UserService::createLogoutUrl('/'));?></div></header>
	<div class="top_title">
		<div class="select_region"></div>
		<div class="select_chanel"></div>
		<div class="change_chanel">
			<div class="chanel_title"></div>
			<div class="chanels_cont">
				<div class="chanel_title_bg_mask"><div class="chanel_title_bg"></div></div>
				<div class="chanels_list">
					<ul id="chanels_list1">
						<li id="chanelid1">Beauty & Fashion</li>
						<li id="chanelid2">Comedy</li>
						<li id="chanelid3">Entertainment & Pop Culture</li>
						<li id="chanelid4">Parenting & Family</li>
						<li id="chanelid5">Music</li>
						<li id="chanelid6">Video Gaming</li>
						<li id="chanelid7">Cars, Trucks & Racing</li>
					</ul>
					<ul id="chanels_list2">
						<li id="chanelid8">Food & Recipes</li>
						<li id="chanelid9">News</li>
						<li id="chanelid10">Science & Education</li>
						<li id="chanelid11">Sports</li>
						<li id="chanelid12">Technology</li>
						<li id="chanelid13">Spanish Language</li>
						<li id="chanelid14">Breakout Videos</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="canvas">
		<!--<div class="zoom-icon-out"></div>-->
		<div class="lineup_sheet"></div>	
			<div class="magazine-viewport">
				<div class="magazine" id="magazine">
					<div ignore="1" class="chanel_popup">
						<div ignore="1" class="chanel_popup_close"></div>
						<div ignore="1" class="chanel_popup_bg"></div>
						<div ignore="1" class="chanel_popup_cont">
							<div ignore="1" id="chanel_popup_iframe" class="chanel_popup_iframe"></div>
							<!--<div ignore="1" class="chanel_popup_overlay"></div>-->
							<div ignore="1" class="chanel_popup_buttons">
								<span ignore="1" class="chanel_popup_title">DOWNLOAD</span>
								<a ignore="1" class="chanel_popup_links chanel_popup_links_pdf" target="_blank" href="#">PDF</a>
								<a ignore="1" class="chanel_popup_links chanel_popup_links_slide"  target="_blank" href="#">SLIDES</a>
								<a ignore="1" class="chanel_popup_links chanel_popup_links_fullscreen"  target="_blank" href="#">FULLSCREEN</a>
							</div>
						</div>
					</div>
				</div>
			</div>	
			<div class="control_bar">
				<div id="slider-bar" class="turnjs-slider">
					<div id="slider"></div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">


	function loadApp() {
		
		$('#canvas').fadeIn(1000);
		
		var lookbook = $('.magazine');
		// Check if the CSS was already loaded
		if (lookbook.width()==0 || lookbook.height()==0) {
			setTimeout(loadApp, 10);
			return;
		}

		lookbook.turn({
				width: 1400,
				height: 932,
				duration: 1000,
				gradients: true,
				autoCenter: true,
				elevation: 50,
				pages: 34,
				when: {
					turning: function(event, page, view) {
						var book = $(this),
						pages = book.turn('pages');
						history.pushState({}, '', _chanels[parseInt(page/2, 10)].name.replace(new RegExp(' ', 'g'),'_').replace(new RegExp('&', 'g'),'and').toLowerCase());
					},
					turned: function(event, page, view) {
						var book = $(this);
						var _pagesmsg='Pages';
						$(this).turn('center');
						$('#slider').slider('value', getViewNumber($(this), page));	
						if(page!=1 && page!=book.turn('pages')){
							if(page%2==0){
								AnimateOnPage(page+1);
							}else {
								AnimateOnPage(page-1);
							}
						} else {
							AnimateOnPage(page);
						}
						var dest1=page,
							dest2=page+1;
						if(page%2==1){ 
							dest1=page-1; 
							dest2=page;
						}
						$('.page.p'+dest1).parent().parent().css('z-index','10');
						if(page!=1 && page!=book.turn('pages')){
							$('.page.p'+dest2).parent().parent().css('z-index','10');
						}
						setTimeout(function(){ doBackgroundAnimationCSS(page); }, 500);		
					},
					missing: function (event, pages) {
						var book = $(this);
						// Add pages that aren't in the magazine
						for (var i = 0; i < pages.length; i++)
							addPage(pages[i], $(this));
					}
				}
		});
		/*
		setTimeout(function(){
			if ($('.magazine').turn('is')){
				if ($('.magazine').turn('page')==1) $('.magazine').turn('peel', 'tr');
			}		
		}, 3000);
	*/
		$(document).keydown(function(e){
			var previous = 37, next = 39, esc = 27;
			switch (e.keyCode) {
				case previous:
					$('.magazine').turn('previous');
					e.preventDefault();
				break;
				case next:
					$('.magazine').turn('next');
					e.preventDefault();
				break;
				case esc:	
					if (_isfullxcreen)  toggleFull();
					e.preventDefault();
				break;
			}
		});

		$(window).resize(function() {
			resizeViewport();
		}).bind('orientationchange', function() {
			resizeViewport();
		});
		
		$(window).on("popstate", function() {
			getURL();
		});
		
		$('.magazine').addClass('animated');
		
		// Load the HTML4 version if there's not CSS transform
		$('.magazine').bind('mousewheel DOMMouseScroll', function(event){	
			if(!$('.magazine').hasClass('zoom-in')){
				if (event.originalEvent.wheelDelta > 0 || event.originalEvent.detail < 0) {
					// scroll up
					$('.magazine').turn('previous');
				}
				else {
					// scroll down
					$('.magazine').turn('next');
				}
			}
		});
		
		$( "#slider" ).slider({
			min: 1,
			max: numberOfViews(lookbook),
			range: "min",
			start: function(event, ui) {
				if (!window._thumbPreview) {
					_thumbPreview = $('<div />', {'class': 'thumbnail'}).html('<div></div>');
					setPreview(ui.value);
					_thumbPreview.appendTo($(ui.handle));
				} else
					setPreview(ui.value);
				moveBar(false);
			},
			slide: function(event, ui) {
				setPreview(ui.value);
			},
			stop: function() {
				if (window._thumbPreview)
					_thumbPreview.removeClass('show');
				$('.magazine').turn('page', Math.max(1, $(this).slider('value')*2 - 2));
			}
		});
		resizeViewport();
		getURL();
	}


	// Load the HTML4 version if there's not CSS transform

	yepnope({
		test : Modernizr.csstransforms,
		yep: ['js/lib/turn.min.js'],
		nope: ['js/lib/turn.html4.min.js', 'css/jquery.ui.html4.css'],
		both: ['css/jquery.ui.css', 'js/magazine.js'],
		complete: loadApp
	});
	
	//Analytic
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-75524637-1', 'auto');
	  ga('send', 'pageview');
	 ///
	</script>
</body>
</html>